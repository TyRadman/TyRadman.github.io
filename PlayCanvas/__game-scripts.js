var Follow=pc.createScript("follow");Follow.attributes.add("target",{type:"entity",title:"Target",description:"The Entity to follow"}),Follow.attributes.add("distance",{type:"number",default:4,title:"Distance",description:"How far from the Entity should the follower be"}),Follow.prototype.initialize=function(){this.vec=new pc.Vec3},Follow.prototype.update=function(t){if(this.target){var e=this.target.getPosition();e.x+=.75*this.distance,e.y+=1*this.distance,e.z+=.75*this.distance,this.vec.lerp(this.vec,e,.1),this.entity.setPosition(this.vec)}};var Movement=pc.createScript("movement");Movement.attributes.add("speed",{type:"number",default:.1,min:.05,max:.5,precision:2,description:"Controls the movement speed"}),Movement.prototype.initialize=function(){this.force=new pc.Vec3},Movement.prototype.update=function(e){var t=0,s=0;if(this.app.keyboard.isPressed(pc.KEY_LEFT)&&(t=-this.speed),this.app.keyboard.isPressed(pc.KEY_RIGHT)&&(t+=this.speed),this.app.keyboard.isPressed(pc.KEY_UP)&&(s=-this.speed),this.app.keyboard.isPressed(pc.KEY_DOWN)&&(s+=this.speed),this.force.x=t,this.force.z=s,this.force.length()){var i=Math.cos(.25*-Math.PI),o=Math.sin(.25*-Math.PI);this.force.set(this.force.x*i-this.force.z*o,0,this.force.z*i+this.force.x*o),this.force.length()>this.speed&&this.force.normalize().scale(this.speed)}this.entity.rigidbody.applyImpulse(this.force)};var Teleportable=pc.createScript("teleportable");Teleportable.prototype.initialize=function(){this.lastTeleportFrom=null,this.lastTeleportTo=null,this.lastTeleport=Date.now(),this.startPosition=this.entity.getPosition().clone()},Teleportable.prototype.update=function(t){this.entity.getPosition().y<0&&this.teleport(this.lastTeleportFrom,this.lastTeleportTo)},Teleportable.prototype.teleport=function(t,e){var o;t&&Date.now()-this.lastTeleport<500||(this.lastTeleport=Date.now(),this.lastTeleportFrom=t,this.lastTeleportTo=e,e?(o=e.getPosition()).y+=.5:o=this.startPosition,this.entity.rigidbody.teleport(o),this.entity.rigidbody.linearVelocity=pc.Vec3.ZERO,this.entity.rigidbody.angularVelocity=pc.Vec3.ZERO)};var Teleport=pc.createScript("teleport");Teleport.attributes.add("target",{type:"entity",title:"Target Entity",description:"The target entity where we are going to teleport"}),Teleport.prototype.initialize=function(){this.target&&this.entity.collision.on("triggerenter",this.onTriggerEnter,this)},Teleport.prototype.onTriggerEnter=function(t){t.script.teleportable&&t.script.teleportable.teleport(this.entity,this.target)};var FirstPersonController=pc.createScript("firstPersonController");FirstPersonController.attributes.add("camera",{type:"entity",description:"Optional, assign a camera entity, otherise one is created"}),FirstPersonController.attributes.add("walkingSpeed",{type:"number",default:10,description:"Adjusts the speed of player movement"}),FirstPersonController.attributes.add("lookSpeed",{type:"number",default:.25,description:"Adjusts the sensitivity of looking"}),FirstPersonController.attributes.add("lookLimit",{type:"number",default:80,description:"The max angle at which the player can look"}),FirstPersonController.attributes.add("shiftFactor",{type:"number",default:3,description:"Speed factor when shift is pressed"}),FirstPersonController.prototype.initialize=function(){this.force=new pc.Vec3,this.eulers=new pc.Vec3;var e=this.app;e.mouse.on("mousemove",this._onMouseMove,this),e.mouse.enablePointerLock(),e.mouse.on("mousedown",(function(){e.mouse.enablePointerLock()}),this),this.entity.collision||console.error("Expected 'collision' component."),this.entity.rigidbody&&this.entity.rigidbody.type===pc.BODYTYPE_DYNAMIC||console.error("Expected DYNAMIC 'rigidbody' component")},FirstPersonController.prototype.update=function(e){this.camera||this._createCamera();var t=this.force,r=this.app,o=this.camera.forward,s=this.camera.right,i=0,a=0;if(r.keyboard.isPressed(pc.KEY_A)&&(i-=s.x,a-=s.z),r.keyboard.isPressed(pc.KEY_D)&&(i+=s.x,a+=s.z),r.keyboard.isPressed(pc.KEY_W)&&(i+=o.x,a+=o.z),r.keyboard.isPressed(pc.KEY_S)&&(i-=o.x,a-=o.z),0!==i&&0!==a){t.set(i,0,a).normalize().scale(this.walkingSpeed);var n=t.scale(r.keyboard.isPressed(pc.KEY_SHIFT)?this.shiftFactor:1);this.entity.rigidbody.applyForce(n)}this.camera.setLocalEulerAngles(this.eulers.y,this.eulers.x,0)},FirstPersonController.prototype._onMouseMove=function(e){pc.Mouse.isPointerLocked()&&(this.eulers.x-=this.lookSpeed*e.dx,this.eulers.y-=this.lookSpeed*e.dy)},FirstPersonController.prototype._createCamera=function(){this.camera=new pc.Entity,this.camera.setName("First Person Camera"),this.camera.addComponent("camera"),this.entity.addChild(this.camera),this.camera.translateLocal(0,.5,0)},FirstPersonController.prototype.ResetPlayer=function(){console.log("camera reset"),this.camera.setLocalEulerAngles(0,0,0),this.entity.setLocalEulerAngles(0,0,0)};var FpsController=pc.createScript("fpsController");FpsController.attributes.add("camera",{type:"entity",description:"Optional, assign a camera entity, otherise one is created"}),FpsController.attributes.add("power",{type:"number",default:2500,description:"Adjusts the speed of player movement"}),FpsController.attributes.add("lookSpeed",{type:"number",default:.25,description:"Adjusts the sensitivity of looking"}),FpsController.attributes.add("shiftFactor",{type:"number",default:3,description:"Speed factor when shift is pressed"}),FpsController.prototype.initialize=function(){this.force=new pc.Vec3,this.eulers=new pc.Vec3;var e=this.app;e.mouse.on("mousemove",this._onMouseMove,this),e.mouse.enablePointerLock(),e.mouse.on("mousedown",(function(){e.mouse.enablePointerLock()}),this),this.entity.collision||console.error("Expected 'collision' component."),this.entity.rigidbody&&this.entity.rigidbody.type===pc.BODYTYPE_DYNAMIC||console.error("Expected DYNAMIC 'rigidbody' component")},FpsController.prototype.update=function(e){this.camera||this._createCamera();var t=this.force,o=this.app,s=this.camera.forward,r=this.camera.right,i=0,a=0;if(o.keyboard.isPressed(pc.KEY_A)&&(i-=r.x,a-=r.z),o.keyboard.isPressed(pc.KEY_D)&&(i+=r.x,a+=r.z),o.keyboard.isPressed(pc.KEY_W)&&(i+=s.x,a+=s.z),o.keyboard.isPressed(pc.KEY_S)&&(i-=s.x,a-=s.z),0!==i&&0!==a){t.set(i,0,a).normalize().scale(this.power);var n=t.scale(o.keyboard.isPressed(pc.KEY_SHIFT)?this.shiftFactor:1);this.entity.rigidbody.applyForce(n)}this.camera.setLocalEulerAngles(this.eulers.y,this.eulers.x,0)},FpsController.prototype._onMouseMove=function(e){pc.Mouse.isPointerLocked()&&(this.eulers.x-=this.lookSpeed*e.dx,this.eulers.y-=this.lookSpeed*e.dy)},FpsController.prototype._createCamera=function(){this.camera=new pc.Entity,this.camera.setName("First Person Camera"),this.camera.addComponent("camera"),this.entity.addChild(this.camera),this.camera.translateLocal(0,.5,0)};var FallTrigger=pc.createScript("fallTrigger");FallTrigger.attributes.add("SpawnPoint",{type:"entity",description:"The point at which the player respawns."}),FallTrigger.attributes.add("PlayerEntity",{type:"entity",description:"The point at which the player respawns."}),FallTrigger.attributes.add("PlayerTag",{type:"string",default:"Player",title:"Player Tag",description:"The point at which the player respawns."}),FallTrigger.prototype.initialize=function(){this.entity.collision.on("triggerenter",this.OnTriggerEnter,this),console.log("player: ",this.PlayerEntity.script.firstPersonController)},FallTrigger.prototype.update=function(t){},FallTrigger.prototype.OnTriggerEnter=function(t){t.tags.has(this.PlayerTag)&&this.RespawnPlayer(t)},FallTrigger.prototype.RespawnPlayer=function(t){t.rigidbody.teleport(this.SpawnPoint.getPosition()),t.rigidbody.linearVelocity=pc.Vec3.ZERO,t.rigidbody.angularVelocity=pc.Vec3.ZERO,t.script.firstPersonController.ResetPlayer()};var PlayerLooker=pc.createScript("PlayerLooker");PlayerLooker.prototype.initialize=function(){this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this)},PlayerLooker.prototype.onMouseDown=function(e){console.log("Clicked");var t=new pc.Vec2(this.app.graphicsDevice.width/2,this.app.graphicsDevice.height/2),i=this.entity.camera.screenToWorld(t.x,t.y,this.entity.camera.nearClip),o=this.entity.camera.screenToWorld(t.x,t.y,this.entity.camera.farClip),r=this.app.systems.rigidbody.raycastFirst(i,o);if(r&&r.entity.script&&r.entity.script.interactable){let e=r.entity.script.interactable.title,t=r.entity.script.interactable.description;"function"==typeof window.updateOverlay?(console.log("First approach read"),window.updateOverlay(e,t)):console.log("Why")}};var Interactable=pc.createScript("interactable");Interactable.attributes.add("title",{type:"string",default:"Untitled"}),Interactable.attributes.add("description",{type:"string",default:"No description provided.",multiline:!0}),Interactable.prototype.initialize=function(){};var UIController=pc.createScript("uiController");UIController.attributes.add("titleTextElement",{type:"entity"}),UIController.attributes.add("descriptionTextElement",{type:"entity"}),UIController.prototype.fillText=function(t,e){this.titleTextElement&&this.titleTextElement.element&&(this.titleTextElement.element.text=t),this.descriptionTextElement&&this.descriptionTextElement.element&&(this.descriptionTextElement.element.text=e)};